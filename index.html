<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Lottie PSMG Summit Agent</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      body { font-family: system-ui, Arial, sans-serif; margin: 2rem; line-height: 1.6; background: #f9fafb; color: #111827; text-align: center; }
      h1 { font-size: 2rem; margin-bottom: 1rem; }
      img.logo { max-width: 100%; height: auto; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin: 1.5rem 0; }
      p { max-width: 600px; margin: 0 auto; }
    </style>
  </head>
  <body>
    <!-- Logo image -->
    <img class="logo" src="https://www.psmg.co.uk/images/~resized-300x200/~resized-strch-download.jpg" alt="PSMG Logo" />

    <!-- ElevenLabs Agent Widget -->
    <elevenlabs-convai
      id="psmgAgent"
      agent-id="agent_6901k5h1cvv7fbvtex52v0a60fn4">
    </elevenlabs-convai>

    <script>
      (function () {
        // --- Read query params (?name=... &company=... or ?first=&last=)
        var qs = new URLSearchParams(location.search);
        function get(k){ return (qs.get(k) || "").replace(/[<>]/g, ""); }

        var name = get("name").trim();
        var first = get("first").trim();
        var last = get("last").trim();
        var company = get("company").trim();

        if (!name) {
          var parts = [first, last].filter(Boolean);
          if (parts.length) name = parts.join(" ");
        }

        var hasName = !!name;
        var hasCompany = !!company;

        // --- Dynamic variables for the agent
        var dyn = {
          customer_name: name || "",
          company: company || ""
        };

        // --- New greetings
        var defaultGreeting =
          "Hi there. I'm Lottie, one of the conference organisers here at PSMG. " +
          "We're super excited to have you on board this year. True to the theme of this year's conference, " +
          "we're continually finding ways to re-invent ourselves and have teamed up with Legal Engine to develop an agent " +
          "(that's me by the way) to get your thoughts and interests ahead of the conference and help with any travel arrangements. " +
          "May I please confirm who I'm speaking with?";

        var personalisedGreeting =
          "Hi " + (hasName ? name : "there") +
          (hasCompany ? " from " + company : "") +
          ". I'm Lottie, one of the conference organisers here at PSMG. We're super excited to have you on board this year. " +
          "True to the theme of this year's conference, we're continually finding ways to re-invent ourselves and have teamed up with Legal Engine " +
          "to develop an agent (that's me by the way) to get your thoughts and interests ahead of the conference and help with any travel arrangements. " +
          "Shall we get started?";

        // If we already know who they are (via query params), use the personalised opener; otherwise use the identity-confirming version
        var firstMessage = (hasName || hasCompany) ? personalisedGreeting : defaultGreeting;

        // --- Apply to widget before it initializes
        var widget = document.getElementById("psmgAgent");
        if (widget) {
          widget.setAttribute("dynamic-variables", JSON.stringify(dyn));
          widget.setAttribute("override-first-message", firstMessage);
        }
      })();
    </script>

    <!-- Load the ElevenLabs widget -->
    <script src="https://unpkg.com/@elevenlabs/convai-widget-embed" async type="text/javascript"></script>
  </body>
</html>
