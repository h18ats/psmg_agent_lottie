<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Lottie · PSMG Summit Agent</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      :root{
        --navy:#0b1f3b;
        --ink:#0f172a;
        --muted:#64748b;
        --bg:#f4f6fb;
        --card:#ffffff;
        --accent:#3b82f6;
        --border:#e5e7eb;
      }
      /* Basic, on-brand look aligned to psmg.co.uk */
      html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family: -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;}
      .wrap{max-width:960px;margin:0 auto;padding:24px}
      .header{background:var(--navy);border-bottom:1px solid #0a1a32}
      .header .inner{max-width:960px;margin:0 auto;padding:12px 24px;text-align:center}
      .logo{max-width:200px;height:auto;display:inline-block;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,.10);background:#fff}
      h1{font-size:26px;margin:16px 0 6px;text-align:center;color:var(--navy)}
      p.lead{margin:0 auto 14px;text-align:center;max-width:720px;color:#334155}
      .card{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:0 6px 20px rgba(15,23,42,.06)}
      .section{padding:18px 20px}
      .muted{color:var(--muted);font-size:14px}
      .fields{display:grid;grid-template-columns:1fr 1fr;gap:12px}
      .field{display:flex;flex-direction:column;gap:6px;text-align:left}
      label{font-size:12px;color:#334155}
      input[readonly]{background:#f8fafc;border:1px solid var(--border);border-radius:10px;padding:10px 12px;color:#0f172a}
      .cta{display:flex;justify-content:center;gap:12px;flex-wrap:wrap;margin-top:16px}
      .btn{display:inline-block;background:var(--accent);color:#fff;text-decoration:none;padding:12px 16px;border-radius:10px;font-weight:700}
      .btn.secondary{background:#e0ecff;color:#0b1f3b}
      .divider{height:1px;background:var(--border);margin:6px 0}
      .center{text-align:center}
      /* Partner strip */
      .partner{display:flex;align-items:center;justify-content:center;gap:12px;flex-wrap:wrap;background:#f8fafc;border:1px solid var(--border);border-radius:12px;padding:10px 12px;margin-top:12px}
      .partner small{color:var(--muted)}
      .le-logo{height:28px;max-width:180px;object-fit:contain;display:block}
      @media (max-width:800px){
        .fields{grid-template-columns:1fr}
      }
      /* Dark mode nicety */
      @media (prefers-color-scheme: dark){
        :root{ --bg:#0b1329; --card:#121a34; --ink:#e8eef7; --border:#2a3865; --muted:#a9b5d2 }
        .logo{background:transparent; box-shadow:none}
        h1{color:#cfe0ff}
        input[readonly]{background:#0f1730;border-color:#2a3865;color:#e8eef7}
        .btn.secondary{background:#203566;color:#e8eef7}
        .partner{background:#0f1730;border-color:#2a3865}
      }
    </style>
  </head>
  <body>
    <!-- Brand header -->
    <div class="header">
      <div class="inner">
        <a href="https://www.psmg.co.uk/" target="_blank" rel="noopener">
          <img class="logo" src="https://www.psmg.co.uk/images/~resized-300x200/~resized-strch-download.jpg" alt="PSMG Logo">
        </a>
      </div>
    </div>

    <div class="wrap">
      <h1>PSMG Full Day London Summit</h1>
      <p class="lead">Thriving in an age of continuous reinvention</p>

      <!-- Prefilled identity (read-only) + Summit website -->
      <div class="card section" style="margin-top:10px">
        <p class="muted center" style="margin-top:0">Your details (from the link) — for your peace of mind</p>
        <div class="fields" style="margin-top:8px">
          <div class="field">
            <label>Full name</label>
            <input id="f_full_name" type="text" readonly placeholder="(not provided)">
          </div>
          <div class="field">
            <label>Company</label>
            <input id="f_company" type="text" readonly placeholder="(not provided)">
          </div>
          <div class="field">
            <label>Email</label>
            <input id="f_email" type="text" readonly placeholder="(not provided)">
          </div>
          <div class="field">
            <label>Job role</label>
            <input id="f_role" type="text" readonly placeholder="(not provided)">
          </div>
        </div>
        <div class="cta">
          <a class="btn" href="https://www.psmg.co.uk/Events/33684-/The-2025-PSMG-Full-Day-London-Summit-Thriving-in-an-age-of-continuous-reinvention" target="_blank" rel="noopener">
            Summit website
          </a>
        </div>
      </div>

      <!-- Agent widget card -->
      <div class="card section" style="margin-top:16px">
        <p class="muted center" id="who" style="margin:0 0 10px"></p>
        <elevenlabs-convai
          id="psmgAgent"
          agent-id="agent_6901k5h1cvv7fbvtex52v0a60fn4">
        </elevenlabs-convai>
        <div class="divider"></div>
        <p class="muted center" style="margin:6px 0 0">Powered by PSMG × Legal Engine</p>

        <!-- Partner strip with Legal Engine logo + About link -->
        <div class="partner">
          <small>In partnership with</small>
          <a id="leLink" href="https://legalengine.co.uk/about-us" target="_blank" rel="noopener" aria-label="About Legal Engine">
            <img class="le-logo" src="https://legalengine.co.uk/hs-fs/hubfs/e8ad0e08-aa6c-4d44-9053-cdcf7bbaec5b.png?width=1704&height=678&name=e8ad0e08-aa6c-4d44-9053-cdcf7bbaec5b.png" alt="Legal Engine">
          </a>
          <a id="leTextLink" class="btn secondary" href="https://legalengine.co.uk/about-us" target="_blank" rel="noopener">About Legal Engine</a>
        </div>
      </div>
    </div>

    <script>
      (function () {
        // ------- Helpers
        var qs = new URLSearchParams(window.location.search);
        function getQ(keys){
          if (Array.isArray(keys)) { for (var i=0;i<keys.length;i++){ var v = qs.get(keys[i]); if(v) return v; } return ""; }
          return qs.get(keys) || "";
        }
        function s(v){ return String(v || "").replace(/[<>]/g, ""); }
        function splitName(full){
          full = (full || "").trim();
          if (!full) return { first:"", last:"" };
          var parts = full.split(/\s+/);
          var first = parts.shift() || "";
          var last  = parts.join(" ");
          return { first:first, last:last };
        }
        function uuid(){
          return 'cid_' + Math.random().toString(36).slice(2,10) + Date.now().toString(36);
        }

        // ------- Read identity + UTM params
        var fullName = s(getQ(["name","full_name","fullname"]));
        var first    = s(getQ(["first","firstname","first_name","fname"]));
        var last     = s(getQ(["last","lastname","last_name","lname"]));
        var role     = s(getQ(["role","job_title","title","position"]));
        var company  = s(getQ(["company","organisation","organization"]));
        var email    = s(getQ(["email","e","mail"]));

        if ((!first || !last) && fullName) {
          var parts = splitName(fullName);
          first = first || parts.first;
          last  = last  || parts.last;
        }
        var normalizedName = (fullName || [first, last].filter(Boolean).join(" ")).trim();

        var utm_source   = s(getQ(["utm_source","source"]));
        var utm_medium   = s(getQ(["utm_medium","medium"]));
        var utm_campaign = s(getQ(["utm_campaign","campaign"]));
        var utm_term     = s(getQ(["utm_term","term"]));
        var utm_content  = s(getQ(["utm_content","content"]));

        var client_id = s(getQ("client_id")) || (localStorage.getItem("psmg_client_id") || uuid());
        try { localStorage.setItem("psmg_client_id", client_id); } catch(e){}

        // ------- Prefill read-only boxes (show the UTM values have passed)
        document.getElementById("f_full_name").value = normalizedName || "";
        document.getElementById("f_company").value   = company || "";
        document.getElementById("f_email").value     = email || "";
        document.getElementById("f_role").value      = role || "";

        // ------- Dynamic variables for the Agent
        var dyn = {
          first_name: first || "",
          last_name:  last  || "",
          full_name:  normalizedName || "",
          role:       role || "",
          company:    company || "",
          email:      email || "",
          client_id:  client_id,
          utm_source:  utm_source || "",
          utm_medium:  utm_medium || "",
          utm_campaign:utm_campaign || "",
          utm_term:    utm_term || "",
          utm_content: utm_content || ""
        };

        // ------- Greeting logic
        var hasIdentity = !!(normalizedName || company);
        var defaultGreeting =
          "Hi there. I'm Lottie, one of the conference organisers here at PSMG. " +
          "We're super excited to have you on board this year. True to the theme of this year's conference, " +
          "we're continually finding ways to re-invent ourselves and have teamed up with Legal Engine to develop an agent " +
          "(that's me by the way) to get your thoughts and interests ahead of the conference and help with any travel arrangements. " +
          "May I please confirm who I'm speaking with?";
        var personalisedGreeting =
          "Hi " + (normalizedName ? normalizedName : "there") +
          (company ? " from " + company : "") +
          ". I'm Lottie, one of the conference organisers here at PSMG. We're super excited to have you on board this year. " +
          "True to the theme of this year's conference, we're continually finding ways to re-invent ourselves and have teamed up with Legal Engine " +
          "to develop an agent (that's me by the way) to get your thoughts and interests ahead of the conference and help with any travel arrangements. " +
          "Shall we get started?";
        var firstMessage = hasIdentity ? personalisedGreeting : defaultGreeting;

        var who = document.getElementById("who");
        if (who && (normalizedName || company)) {
          who.textContent = "Detected: " + [normalizedName, company ? "("+company+")" : ""].filter(Boolean).join(" ");
        }

        var widget = document.getElementById("psmgAgent");
        if (widget) {
          widget.setAttribute("dynamic-variables", JSON.stringify(dyn));
          widget.setAttribute("override-first-message", firstMessage);
        }

        // Optional: log to n8n (minimal)
        try {
          var payload = new URLSearchParams();
          payload.set("event","landing_context");
          payload.set("client_id", client_id);
          payload.set("first_name", dyn.first_name);
          payload.set("last_name",  dyn.last_name);
          payload.set("full_name",  dyn.full_name);
          payload.set("role",       dyn.role);
          payload.set("company",    dyn.company);
          payload.set("email",      dyn.email);
          payload.set("utm_source", utm_source);
          payload.set("utm_medium", utm_medium);
          payload.set("utm_campaign", utm_campaign);
          payload.set("utm_term",   utm_term);
          payload.set("utm_content",utm_content);
          payload.set("page_url",   location.href);
          fetch("https://leonard-dev.app.n8n.cloud/webhook/luke-pre-brief", {
            method:"POST",
            headers:{ "Content-Type":"application/x-www-form-urlencoded" },
            body: payload.toString()
          }).catch(function(){});
        } catch(e){}

        // --- Append current querystring to Legal Engine About links (so UTMs follow)
        var qsString = window.location.search || "";
        var leA = document.getElementById("leLink");
        var leB = document.getElementById("leTextLink");
        if (leA) leA.href = "https://legalengine.co.uk/about-us" + qsString;
        if (leB) leB.href = "https://legalengine.co.uk/about-us" + qsString;
      })();
    </script>

    <!-- Load the ElevenLabs widget -->
    <script src="https://unpkg.com/@elevenlabs/convai-widget-embed" async type="text/javascript"></script>
  </body>
</html>
